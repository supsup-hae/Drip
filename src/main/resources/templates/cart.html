<%@ page import="org.hello.dbpproject.entity.Member" %>
<%@ page import="org.hello.dbpproject.entity.Product" %>
<%@ page import="java.util.List" %>
<%@ page import="java.util.ArrayList" %>
<%@ page import="java.util.Optional" %>
<%@ page import="java.util.Collections" %>
<%@ page import="java.util.stream.Collectors" %><%--
  Created by IntelliJ IDEA.
  User: USER
  Date: 2024-04-23
  Time: 오후 5:50
  To change this template use File | Settings | File Templates.
--%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<html>
<head>
    <meta charset="UTF-8">
    <title>Drips</title>
    <%--API--%>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"
    />

    <%--Styles--%>
    <link rel="stylesheet" href="../css/carousel.css">
    <link rel='stylesheet' href='../css/bootstrap/bootstrap.css'>
    <link rel="stylesheet" href="../css/navbar.css">
    <link rel="stylesheet" href="../css/index-page.css">
    <link
            href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.2.0/mdb.min.css"
            rel="stylesheet"
    />

    <%--Fonts--%>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="../css/fonts.css">
    <link rel="stylesheet"
          href="https://fonts.googleapis.com/css2?family=Luckiest+Guy&display=swap">
</head>
<body>
<%--JSP--%>
<jsp:useBean id="member" class="org.hello.dbpproject.entity.Member" scope="session"/>
<jsp:setProperty name="member" property="*"/>

<%--Nav--%>
<nav class="navbar navbar-expand-lg shadow sticky-top shadow-sm">
    <div class="container-fluid">
        <a class="navbar-brand" href="./index.jsp">
            <img src="../images/logo.png" alt="Drips" width="64" height="60">
        </a>
        <button class="navbar-toggler collapsed" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbar-content">
            <div class="hamburger-toggle">
                <div class="hamburger">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
        </button>
        <div class="collapse navbar-collapse" id="navbar-content">
            <ul class="navbar-nav nav-underline mr-auto mb-2 mb-lg-0 ">
                <li class="nav-item dropdown dropdown-mega position-static">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown"
                       data-bs-auto-close="outside">Roasters</a>
                    <div class="dropdown-menu shadow">
                        <div class="mega-content px-4">
                            <div class="container-fluid">
                                <div class="row">
                                    <div class="col-12 col-sm-4 col-md-3 py-4">
                                        <div class="card">
                                            <img src="../images/lowkey/logo.jpg"
                                                 class="img-fluid" alt="image">
                                            <div class="card-body">
                                                <figure>
                                                    <blockquote class="blockquote text-center py-2">
                                                        <p>lowkey</p>
                                                    </blockquote>
                                                    <figcaption
                                                            class="blockquote-footer text-center">
                                                        서울특별시 성동구 연무장3길 6 <br>
                                                        <a href="lowkey.jsp"
                                                           class="stretched-link"></a>
                                                    </figcaption>
                                                </figure>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-4 col-md-3 py-4">
                                        <div class="card">
                                            <img src="../images/pastel/logo.jpg"
                                                 class="img-fluid" alt="image">
                                            <div class="card-body">
                                                <figure>
                                                    <blockquote class="blockquote text-center py-2">
                                                        <p>Pastel Coffee Works</p>
                                                    </blockquote>
                                                    <figcaption
                                                            class="blockquote-footer text-center">
                                                        서울특별시 마포구 성지길 58 1층
                                                        <a href="PastelCoffeeWorks.jsp"
                                                           class="stretched-link"></a>
                                                    </figcaption>
                                                </figure>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-4 col-md-3 py-4">
                                        <div class="card">
                                            <img src="../images/peer/logo.jpg"
                                                 class="img-fluid" alt="image">
                                            <div class="card-body">
                                                <figure>
                                                    <blockquote class="blockquote text-center py-2">
                                                        <p>Peer Coffee</p>
                                                    </blockquote>
                                                    <figcaption
                                                            class="blockquote-footer text-center">
                                                        서울특별시 성동구 연무장3길 6
                                                        <a href="PeerCoffee.jsp"
                                                           class="stretched-link"></a>
                                                    </figcaption>
                                                </figure>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-12 col-sm-12 col-md-3 py-4">
                                        <div class="card">
                                            <img src="../images/heureum/logo.jpg"
                                                 class="img-fluid" alt="image">
                                            <div class="card-body">
                                                <figure>
                                                    <blockquote class="blockquote text-center py-2">
                                                        <p>커피흐름</p>
                                                    </blockquote>
                                                    <figcaption
                                                            class="blockquote-footer text-center">
                                                        경기도 수원시 영통구 하동 975-2
                                                        <a href="CoffeeHeureum.jsp"
                                                           class="stretched-link"></a>
                                                    </figcaption>
                                                </figure>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown"
                       data-bs-auto-close="outside">Products</a>
                    <ul class="dropdown-menu shadow">
                        <li><a class="dropdown-item unavailable"  href="${pageContext.request.contextPath}/content/drip-bag.jsp">DripBag</a></li>
                        <li><a class="dropdown-item unavailable" href="${pageContext.request.contextPath}/content/supplies.jsp">Supplies</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="${pageContext.request.contextPath}/content/addProduct.jsp">Add Product</a>
                </li>
            </ul>
            <ul class="navbar-nav ms-auto">
                <li class="user-info ms-2 m-auto">
                    <c:if test="${member.status}">
                    <p class="m-0">
                        <c:out value="${member.name}"/>
                        님 어서오세요!
                    </p>
                    </c:if>
                <li class="nav-theme nav-item">
                    <a class="nav-link icons" href="#" tabindex="-1" data-bs-toggle-theme="true"
                       aria-disabled="true">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                             fill="currentColor" class="bi bi-circle-half" viewBox="0 0 16 16">
                            <path d="M8 15A7 7 0 1 0 8 1zm0 1A8 8 0 1 1 8 0a8 8 0 0 1 0 16"/>
                        </svg>
                    </a>
                </li>
                <li class="nav-user">
                    <a class="nav-link icons" href="${pageContext.request.contextPath}/profile"
                       tabindex="-1"
                       data-bs-toggle="tooltip" data-bs-placement="bottom"
                       data-bs-title="Login"
                       aria-disabled="true">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                             fill="currentColor" class="bi bi-person-circle" viewBox="0 0 16 16">
                            <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>
                            <path fill-rule="evenodd"
                                  d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>
                        </svg>
                    </a>
                </li>
                <li class="nav-cart">
                    <a class="nav-link icons" href="${pageContext.request.contextPath}/cart"
                       tabindex="-1"
                       aria-disabled="true">
                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24"
                             fill="currentColor" class="bi bi-bag-fill" viewBox="0 0 16 16">
                            <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1m3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4z"/>
                        </svg>
                    </a>
                </li>
            </ul>

        </div>
    </div>
</nav>
<%--Nav--%>


<%-- Section: Design Block --%>
<section class="text-center position-relative">
    <div id="liveAlertPlaceholder" class="position-absolute position-absolute top-0 start-50 translate-middle-x z-1 mt-1"></div>
    <%-- Background image --%>
    <div class="p-5 bg-image object-cover " style="
        background-image: url('../images/peer/swiper.jpg');
        height: 110vh;
        "></div>
    <%-- Background image --%>

    <div class="d-flex card mx-4 mx-md-5 shadow-5-strong w-75 position-absolute"
         style="
        margin-top: -900px;
        left: 10%;
        background: hsla(0, 0%, 100%, 1);
        backdrop-filter: blur(30px);
        ">
        <div class="card-body py-5 px-md-5 w-75 m-auto">
            <div class="row d-flex align-items-center justify-content-center">
                <div class="">
                    <h2 class="fw-bold mb-5">- 장바구니 -</h2>
                    <table class="table bg-transparent table-hover align-middle mb-0 w-100 bg-transparent mb-5">
                        <thead>
                        <tr>
                            <th scope="col"></th>
                            <th scope="col">상품명</th>
                            <th scope="col">로스터리</th>
                            <th scope="col">수량</th>
                            <th scope="col">주문 금액</th>
                            <th scope="col">배송비</th>
                        </tr>
                        </thead>
                        <tbody class="table-group-divider table-divider-color">
                        <%
                            /*List<Product> cartList = new ArrayList<>(Optional.ofNullable((List<Product>) session.getAttribute("cartList"))
                                    .orElseGet(Collections::emptyList));*/
                            List<Product> cartList = (List<Product>) session.getAttribute("cartList");
                            System.out.println("장바구니 리스트 정보: " +cartList.toString());
                            for (Product product : cartList) {
                                System.out.println(product);
                        %>
                        <tr>
                            <th scope="row">
                                <div class="form-check m-auto">
                                    <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault"/>
                                </div>
                            </th>
                            <td>
                                <div class="d-flex align-items-center">
                                        <img
                                                src="<%= product.getImgPath().get(0)%>"
                                                alt=""
                                                style="width: 45px; height: 45px"
                                        />
                                    <div class="ms-3">
                                        <p class="fw-bold mb-1"><a
                                                href="${pageContext.request.contextPath}/content/productInfo.jsp?id=<%= product.getProductId()%>"
                                                class="link-dark"><%=product.getProductName()%>
                                        </a></p>
                                    </div>
                                </div>
                            </td>
                            <td>
                                <p class="fw-normal mb-1"><a href="/content/<%=product.getProductRoastery()%>.jsp"
                                                             class="link-dark"><%=product.getProductRoastery()%>
                                </a></p>
                            </td>
                            <td>
                                <span class="ms-2"><%=product.getQuantity()%></span>
                            </td>
                            <td class="ms-2">
                                <span class="ms-2"><%=product.getProductPrice()%></span>
                            </td>
                            <td>
                                <span class="">
                                    3,000
                                </span>
                            </td>
                            <td>
                                <%
                                    session.setAttribute("selectedProductId", product.getProductId());
                                %>
                                <form class="m-auto" id="deleteFromCart" action="${pageContext.request.contextPath}/deleteFromCart" method="post">
                                    <button type="submit" class="btn btn-link btn-sm px-3 w-auto delete-btn" data-mdb-ripple-init data-ripple-color="primary" form="deleteFromCart">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor"
                                             class="bi bi-x-square text-black" viewBox="0 0 16 16">
                                            <path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2z"/>
                                            <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708"/>
                                        </svg>
                                    </button>
                                </form>
                            </td>
                        </tr>
                        <%
                            }
                        %>
                        </tbody>
                    </table>


                    <table class="table bg-transparent table-hover align-middle mb-0 w-100 bg-transparent mt-5">
                        <thead>
                        <tr>
                            <th scope="col" class="col-4 text-center">총 주문 금액</th>
                            <th scope="col" class="col-4 text-center">총 배송비</th>
                            <th scope="col" class="col-4 text-center">총 결제 금액</th>
                        </tr>
                        </thead>
                        <tbody class="table-group-divider table-divider-color">
                        <%
                            int productsPrice = cartList.stream().mapToInt(product -> product.getProductPrice() * product.getQuantity()).sum();
                            int numberOfProduct = cartList.size();
                            int shippingCost = cartList.stream().map(Product::getProductRoastery).collect(Collectors.toSet()).size() * 3000;
                            int totalBill = productsPrice + shippingCost;
                        %>
                        <tr>
                            <td class="text-center">
                                <figure class="text-center mt-2">
                                    <blockquote class="blockquote">
                                        <p><%= productsPrice %> 원
                                        </p>
                                    </blockquote>
                                    <figcaption class="blockquote-footer">
                                        총 <%= numberOfProduct %> 개
                                    </figcaption>
                                </figure>
                            </td>
                            <td class="text-center">
                                <h5 class="ms-2 text-center">
                                    <%= shippingCost %> 원
                                </h5>
                            </td>
                            <td class="text-center">
                                <h5 class="text-center">
                                    <%= totalBill %> 원
                                </h5>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                    <div class="row justify-content-center mt-5">
                        <div class="col-6">
                            <div class="btn-group shadow-0 d-flex" role="group" aria-label="Basic example">
                                <button type="button" class="btn btn-outline-dark w-100" data-mdb-color="dark" data-mdb-ripple-init>
                                    <p class="btn-text m-auto"><a class="link-dark" href="/content/index.jsp">돌아가기</a></p>
                                </button>
                                <button type="button" class="btn btn-outline-dark w-100 " data-mdb-color="dark" data-mdb-ripple-init
                                        id="liveAlertBtn">
                                    <p class="btn-text m-auto">구매하기</p>
                                    <%--이제 구매하기 누르면 리스트 초기호 ㅏ되는거 구현하고, 마무리하면 될거같다.--%>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<%-- Section: Design Block --%>


<%--Footer--%>
<footer class="text-center text-lg-start bg-body-tertiary text-muted pt-5">
    <%-- Section: Links  --%>
    <section class="">
        <div class="container text-center text-md-start mt-5">
            <%-- Grid row --%>
            <div class="row mt-3">
                <%-- Grid column --%>
                <div class="col-md-3 col-lg-4 col-xl-3 mx-auto mb-4">
                    <%-- Content --%>
                    <h6 class="text-uppercase fw-bold mb-4">
                        <i class="fas fa-gem me-3"></i> 201958110 신윤섭
                    </h6>
                    <p>
                        DataBase Programming
                    </p>
                </div>
                <%-- Grid column --%>

                <%-- Grid column --%>
                <div class="col-md-2 col-lg-2 col-xl-2 mx-auto mb-4">
                    <%-- Links --%>
                    <h6 class="text-uppercase fw-bold mb-4">
                        Roastery
                    </h6>
                    <p>
                        <a href="/content/lowkey.jsp" class="text-reset">lowkey</a>
                    </p>
                    <p>
                        <a href="/content/PastelCoffeeWorks.jsp" class="text-reset">Pastel Coffee Works</a>
                    </p>
                    <p>
                        <a href="/content/PeerCoffee.jsp" class="text-reset">Peer Coffee</a>
                    </p>
                    <p>
                        <a href="/content/CoffeeHeureum.jsp" class="text-reset">Coffee Heureum</a>
                    </p>
                </div>
                <%-- Grid column --%>

                <%-- Grid column --%>
                <div class="col-md-3 col-lg-2 col-xl-2 mx-auto mb-4">
                    <%-- Links --%>
                    <h6 class="text-uppercase fw-bold mb-4">
                        Products
                    </h6>
                    <p>
                        <a href="content/drip-bag.jsp" class="text-reset">Drip Bag</a>
                    </p>
                    <p>
                        <a href="/content/supplies.jsp" class="text-reset">Supplies</a>
                    </p>
                </div>
                <%-- Grid column --%>

                <%-- Grid column --%>
                <div class="col-md-4 col-lg-3 col-xl-3 mx-auto mb-md-0 mb-4">
                    <%-- Links --%>
                    <h6 class="text-uppercase fw-bold mb-4">Contact</h6>
                    <p><i class="fas fa-home me-3"></i>한신대학교 장준하기념관 18201-1</p>
                    <p>
                        <i class="fas fa-envelope me-3"></i>
                        zksdbstjq@hs.ac.kr
                    </p>
                    <p><i class="fas fa-phone me-3"></i>010-1234-5679</p>
                </div>
                <%-- Grid column --%>
            </div>
            <%-- Grid row --%>
        </div>
    </section>
    <%-- Section: Links  --%>

    <%-- Copyright --%>
    <div class="text-center p-4 bg-black text-light">
        © 2024 Copyright:
        <a class="text-reset fw-bold link-light" href="https://github.com/F-UMI">Shin Yun Seop</a>
    </div>
    <%-- Copyright --%>
</footer>
<%--Footer--%>
<%--Script--%>
<script src="//t1.daumcdn.net/mapjsapi/bundle/postcode/prod/postcode.v2.js"></script>
<script>

</script>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script src='../js/bootstrap.bundle.min.js'></script>
<script src="../js/day-night.js"></script>
<script src="../js/swiper.js"></script>
<script src="../js/form-validate.js"></script>
<script src="../js/snippets.js"></script>
<script src="../js/delete-from-cart.js"></script>
<script src="../js/navbar.js"></script>

<%-- MDB --%>
<script
        type="text/javascript"
        src="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/7.2.0/mdb.umd.min.js"
></script>
</body>
</html>